class Solution {
    public long countSubarrays(int[] nums, int minK, int maxK) {
        int n=nums.length;
        int lastMin=-1, lastMax=-1, lastBad=-1;
        long count =0;

        for(int i=0; i<n; i++){
            int val=nums[i];
            if(val<minK||val>maxK){
                lastBad=i;
            }
            if(val==minK){
                lastMin=i;
            }
            if(val==maxK){
                lastMax=i;
            }
            int validStart=Math.min(lastMin,lastMax);
            if(validStart>lastBad){
                count+=validStart-lastBad;
            }
        }
        return count;
        
    }
}
